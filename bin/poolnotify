#!/usr/bin/ruby
require 'rubygems'
$:.unshift(File.join(File.dirname(__FILE__), "lib"))
require 'poolparty'

def notify(mess);`/usr/local/bin/growlnotify -m "Your #{PoolParty.options.keypair} cloud #{mess}"`;end

master = PoolParty::Master.new

@size = master.nodes.size

notify("is #{@size} big")
blk = lambda {
  loop do
    sz = master.nodes.size
    
    @size > sz ? notify("shrank") : notify("grew") unless @size == sz

    wait 2.minutes  
  end
}

PoolParty::Application.production? ? daemonize(&blk) : blk.call