#!/usr/bin/ruby
require 'rubygems'
require 'pool_party'

# Set defaults
list = PoolParty::Optioner.parse(ARGV.dup)
options = PoolParty::Application.options(ARGV.dup)
master = PoolParty::Master.new

instance_options = {
  :instance_number => 0,
  :cmd => "ls -l",
  :src => "",
  :dest => ""
}
OptionParser.new do |op|
  op.on_tail("-h", "--help", "Show this message") do |o|
    puts "pool <options> {start|stop|list|maintain|restart}"
    exit
  end
end.parse!(ARGV.dup)


case list[0]
when "start"
  PoolParty.message "Starting cloud"
  master.start_cloud!
when "stop"
  PoolParty.message "Stopping cloud"
  master.request_termination_of_all_instances  
when "list"
  puts master.list
when "maintain"
  PoolParty.message "Maintaining cloud"
  master.start_monitor!
when "restart"
  PoolParty.message "Restarting cloud"
  master.request_termination_of_all_instances
  master.start_cloud!
else
  puts master.list
end